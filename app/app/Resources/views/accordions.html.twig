
{% block stylesheets %}
    {% stylesheets
    'css/accordions.css'
    filter='cssrewrite'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% set manager = true %}

<script>
    function toggleAccordion(e) {

        var caretbutton = $(e).find('.caretbutton');
        if (caretbutton.text() == 'arrow_drop_down') {
            caretbutton.text('arrow_drop_up');
        } else {
            caretbutton.text('arrow_drop_down');
        }

        $('.accordion-title').removeClass('active');
        $(e).addClass('active');

        var panel = e.nextElementSibling;
        if ($(".accordion-panel-notform")[0]) {
            $('.accordion-panel-notform').removeClass('active');
        }
        if ($(".accordion-panel-form")[0]) {
            $('.accordion-panel-form').removeClass('active');
        }
        $(panel).addClass("active");
        $(panel).toggle();

        /*
        var deletebutton = $(panel).find(".accordion_delete_button");
        $(".accordion_delete_button").removeAttr("id");
        deletebutton.attr("id", "active_delete_button");
        */

        {% if manager %}
            $('.accordion_delete_button').on("click", function () {
                var deleteBox = $('#deleteBox');
                deleteBox.find('form').attr("action", $(this).data('targeturl'));
                deleteBox.find('.displayname').text($(this).data('displayname'));
                deleteBox.modal('show');
            });

        {# **********  ediform ********* #}
        $('.accordion_edit_button').on("click", function () {
            var panel = $(this).closest('.accordion-panel');
            panel.find('.accordion-editform').removeClass('hidden');
            panel.find('table.accordion').addClass('hidden');
            panel.find('.accordion_edit_button').addClass('hidden');
        });
        $('.accordion_edit_button').on("click", function () {
            var panel = $(this).closest('.accordion-panel');
            panel.find('.accordion-editform').removeClass('hidden');
            panel.find('table.accordion').addClass('hidden');
            panel.find('.accordion_edit_button').addClass('hidden');
        });
        $('.accordion_edit_cancel_button').on("click", function () {
            var panel = $(this).closest('.accordion-panel');
            panel.find('.accordion-editform').addClass('hidden');
            panel.find('table.accordion').removeClass('hidden');
            panel.find('.accordion_edit_button').removeClass('hidden');
        });
        $('.accordion_edit_submit_button').on("click", function () {
            var panel = $(this).closest('.accordion-panel');
            panel.find('form').submit();
        });


        {% endif %}
    }

</script>

<div class="{% if formaccordion is defined %}accordion-container-{{ formaccordion }}{% endif %} accordion-style-{{ variant }}">
    <div class="accordion-header">{{ heading }}</div>
    <div>
        {% for itemId, item in items %}
         <!--   <div {/% if classToFilter is defined %} class="instafilta-target"{/% endif %}> -->

                <div onclick="toggleAccordion(this);"
                     class="accordion-title {% if formtitle is defined %}accordion-title-style-{{ variant }}-{{ formtitle }}{% else %}accordion-title-style-{{ variant }}{% endif %} {% if classToFilter is defined %} instafilta-target {% endif %}"
                     data-name="{{ item.title }}">
                    {{ item.title }}
                    <span class="accordion-title-middle">{% if item.titlemiddle is defined %}{{ item.titlemiddle }}{% endif %}</span>
                    <span class="accordion-title-right pull-right">
                    <span class="accordion-buttons">
                        <i class="caretbutton material-icons">arrow_drop_down</i>
                    </span>
                </span>
                </div>

                <div class="accordion-panel {% if formpanel is defined %}accordion-panel-{{ formpanel }}{% endif %} accordion-panel-style-{{ variant }}"
                     style="display: none;">
                    {% if item.subaccordions is defined %}
                        {% if item.description is defined %}
                            <div class="accordion-description">{{ item.description }}</div> {% endif %}
                        {% for id, subaccordion in item.subaccordions %}
                            <div class="accordion-container accordion-style-{{ subaccordion.variant }}" data-id="{{ id }}">
                                <div class="accordion-header"></div>
                                <div onclick="toggleAccordion(this);"
                                     class="accordion-title accordion-title-style-{{ subaccordion.variant }}"
                                     data-name="{{ subaccordion.title }}">
                                    <span>{{ subaccordion.title }}</span>
                                    <span class="accordion-title-middle">{% if subaccordion.titlemiddle is defined %}{{ subaccordion.titlemiddle }}{% endif %}</span>
                                    <span class="accordion-title-right pull-right">
                                        <span class="accordion-title-text">{% if subaccordion.titletext is defined %}{{ subaccordion.titletext }}{% endif %}</span>
                                        <span class="accordion-buttons">
                                            {% if subaccordion.buttons is defined %}
                                                {% for id, button in subaccordion.buttons %}
                                                    <i {% if id is defined %} id="{{ id }}"{% endif %}
                                                            class="material-icons {% if button.class is defined %} {{ button.class }} {% endif %}">{{ button.icon }}</i>
                                                {% endfor %}
                                            {% endif %}
                                            <i class="caretbutton material-icons">arrow_drop_down</i>
                                        </span>
                                    </span>
                                </div>
                                <div class="accordion-panel accordion-panel-style-{{ subaccordion.variant }}"
                                     style="display: none;">
                                    <table cellspacing="0" class="accordion">
                                        {% for content in subaccordion.contents %}
                                            <tr class="accordion">
                                                <td class="{% if not loop.first %}accordion-hr{% endif %} accordion accordion-key">{{ content.key }}</td>
                                                <td class="{% if not loop.first %}accordion-hr{% endif %} accordion">
                                                    <ul class="accordion">
                                                        {% for listitem in content.values %}
                                                        <li>{{ listitem }}
                                                            {% endfor %}
                                                    </ul>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        {% if heading != "Entity IDs" and manager %}
                        <div class="accordion_button_row pull-right">
                            {% if item.form is defined %}
                                <i title="update role" class="material-icons accordion-button accordion_edit_button">create</i>
                            {% endif %}
                            <i title="delete role" class="material-icons accordion-button accordion_delete_button" data-id="{{ itemId }}" data-targeturl="{{ item.deleteUrl }}" data-displayname="{{ item.title }}">delete</i>
                        </div>
                        {% endif %}
                        {% if item.form is defined %}
                            <div class="hidden accordion-editform">
                                <div class="pull-right">
                                    <i class="material-icons accordion-button accordion_edit_cancel_button">clear</i>
                                    <i class="material-icons accordion-button accordion_edit_submit_button">done</i>
                                </div>
                                {{ form(item.form) }}
                            </div>
                        {% endif %}
                        <table cellspacing="0" class="accordion">

                            {% for content in item.contents %}
                                <tr class="accordion">
                                    <td class="{% if loop.index != 1 %}accordion-hr{% endif %} accordion accordion-key">{{ content.key }}</td>
                                    <td class="{% if loop.index != 1 %}accordion-hr{% endif %} accordion">
                                        <ul class="accordion">
                                            {% for listitem in content.values %}
                                                {% if content.key == "Multivalue" %}
                                                    {% if listitem == null %}
                                                        <i class="material-icons">clear</i>
                                                    {% endif %}
                                                    {% if listitem == true %}
                                                        <i class="material-icons">check</i>
                                                    {% endif %}
                                                {% else %}
                                                    <li>{{ listitem }}</li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </td>
                                </tr>
                            {% endfor %}
                            {% if token is defined %}
                                <tr class="accordion">
                                    <td>
                                        <a class="button"
                                           href="{{ path('app_service_generatetoken', {'id': service_id, 'permissionsetname': item.title}) }}">Generate
                                            token</a>
                                    </td>
                                    {% if permissionsetname == item.title %}
                                        <td>
                                            <input type="text" id="generatedtoken" readonly value="{{ tokenstring }}">
                                        </td>
                                    {% else %}
                                        <td>
                                            <input type="text" id="generatedtoken" readonly>
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endif %}
                        </table>
                    {% endif %}
                </div>
        {% endfor %}
    </div>
</div>

{{ include('::modal.html.twig',
{
    id: 'deleteBox',
    title: 'Are you sure?',
    bodycontent: 'If you press the delete button, <strong><span class="displayname"></span></strong> will be deleted.',
    button:
    {
        text: 'Delete',
        class: 'btn-red',
        id: 'deleteButton'
    },
    leftbutton:
    {
        text: 'Cancel',
        class: 'btn-blue',
        id: 'id_of_leftbutton',
        dismiss: true
    },
    formaction: ""
})
}}